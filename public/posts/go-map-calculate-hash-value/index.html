<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>How does go calculate a hash value for keys in a map? :: Resyon&#39;s World</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="How does go calculate a hash value for keys in a map?  ref
 original   The language spec doesn&amp;rsquo;t say, which means that it&amp;rsquo;s free to change at any time, or differ between implementations.
  The hash algorithm varies somewhat between types and platforms. As of now: On x86 (32 or 64 bit) if the CPU supports AES instructions, the runtime uses aeshash, a hash built on AES primitives, otherwise it uses a function &amp;ldquo;inspired by&amp;rdquo; xxHash and cityhash, but different from either." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://resyon.github.io/posts/go-map-calculate-hash-value/" />




<link rel="stylesheet" href="https://resyon.github.io/assets/style.css">

  <link rel="stylesheet" href="https://resyon.github.io/assets/green.css">






<link rel="apple-touch-icon" href="https://resyon.github.io/img/apple-touch-icon-192x192.png">

  <link rel="shortcut icon" href="https://resyon.github.io/img/favicon/green.png">



<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="How does go calculate a hash value for keys in a map?">
<meta property="og:description" content="How does go calculate a hash value for keys in a map?  ref
 original   The language spec doesn&amp;rsquo;t say, which means that it&amp;rsquo;s free to change at any time, or differ between implementations.
  The hash algorithm varies somewhat between types and platforms. As of now: On x86 (32 or 64 bit) if the CPU supports AES instructions, the runtime uses aeshash, a hash built on AES primitives, otherwise it uses a function &amp;ldquo;inspired by&amp;rdquo; xxHash and cityhash, but different from either." />
<meta property="og:url" content="https://resyon.github.io/posts/go-map-calculate-hash-value/" />
<meta property="og:site_name" content="Resyon&#39;s World" />

  <meta property="og:image" content="https://resyon.github.io/">

<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">


  <meta property="article:published_time" content="2021-10-10 15:27:19 &#43;0800 CST" />












</head>
<body class="green">


<div class="container full headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Resyon&#39;s World
  </div>
</a>

    </div>
    
      <div class="menu-trigger">menu</div>
    
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/posts/about">About</a></li>
        
      
        
          <li><a href="https://github.com/resyon">Github</a></li>
        
      
      
    

    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/posts/about">About</a></li>
      
    
      
        <li><a href="https://github.com/resyon">Github</a></li>
      
    
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="https://resyon.github.io/posts/go-map-calculate-hash-value/">How does go calculate a hash value for keys in a map?</a></h1>
  <div class="post-meta">
    
      <span class="post-date">
        2021-10-10
        
      </span>
    
    
      <span class="post-author">:: resyon</span>
    
    
  </div>

  
  <span class="post-tags">
    
    #<a href="https://resyon.github.io/tags/golang/">golang</a>&nbsp;
    
  </span>
  
  


  

  <div class="post-content"><div>
        <h1 id="how-does-go-calculate-a-hash-value-for-keys-in-a-map">How does go calculate a hash value for keys in a map?<a href="#how-does-go-calculate-a-hash-value-for-keys-in-a-map" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<blockquote>
<p><a href="https://stackoverflow.com/questions/37625480/how-does-go-calculate-a-hash-value-for-keys-in-a-map">ref</a></p>
</blockquote>
<h2 id="original">original<a href="#original" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<ol>
<li>
<p>The language spec doesn&rsquo;t say, which means that it&rsquo;s free to change at any time, or differ between implementations.</p>
</li>
<li>
<p>The hash algorithm varies somewhat between types and platforms. As of now: On x86 (32 or 64 bit) if the CPU supports AES instructions, the runtime uses aeshash, a hash built on AES primitives, otherwise it uses a function &ldquo;inspired by&rdquo; xxHash and cityhash, but different from either. There are different variants for 32-bit and 64-bit systems. Most types use a simple hash of their memory contents, but floating-point types have code to ensure that 0 and -0 hash equally (since they compare equally) and NaNs hash randomly (since two NaNs are never equal). Since complex types are built from floats, their hashes are composed from the hashes of their two floating-point parts. And an interface&rsquo;s hash is the hash of the value stored in the interface, and not the interface header itself.</p>
</li>
<li>
<p>All of this stuff is in private functions, so no, you can&rsquo;t access Go&rsquo;s internal hash for a value in your own code.</p>
</li>
<li>
<p>if two things compare equal with == they must have equal hashes (or maps wouldn&rsquo;t work&hellip; this is also the reasoning behind all of the special cases I outlined above). That means that strings hash their bodies, not their headers. And structs compose the hashes of all of their fields. I can&rsquo;t find the code actually implementing that, but the tests and the comparison rules make it clear.</p>
</li>
</ol>
<h2 id="summary">summary<a href="#summary" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<ol>
<li>平台/体系结构相关, <code>func hash</code>绑定至<code>_type.alg</code>中, <code>x86</code>下且支持<code>AES</code>指令使用基于<code>AES</code>原语的<code>aeshash</code>, 否则&hellip;</li>
<li><code>float</code>的计算方式比较特殊, 由于<code>IEEE-754</code>.</li>
<li><code>interface</code>的哈希根据存储其中的<code>hash value</code>计算出, 而非头部</li>
<li><code>string</code>, <code>struct</code> 的哈希值由构成他们的域/字符计算得出, 而非头部</li>
<li><code>golang</code>定义的<code>hash</code>均为私有, 但可以通过<code>==</code>推断二者的<code>hash value</code>是否相等, <a href="https://golang.org/ref/spec#Comparison_operators">但注意 <code>slice</code>, <code>map</code>, <code>func</code>, <code>带有前面3者的array &amp;&amp; struct</code>不可比较</a></li>
</ol>

      </div></div>

  
  
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h">Read other posts</span>
        <hr />
    </div>
    <div class="pagination__buttons">
        
        <span class="button previous">
            <a href="https://resyon.github.io/posts/awesome-nil-channel/">
                <span class="button__icon">←</span>
                <span class="button__text">awesome way to make use of nil channel</span>
            </a>
        </span>
        
        
        <span class="button next">
            <a href="https://resyon.github.io/posts/golang-nil-interface/">
                <span class="button__text">golang nil interface</span>
                <span class="button__icon">→</span>
            </a>
        </span>
        
    </div>
</div>

  

  

</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">
        <span>© Resyon 2022</span>
    
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
  </div>
</footer>

<script src="https://resyon.github.io/assets/main.js"></script>
<script src="https://resyon.github.io/assets/prism.js"></script>







  
</div>

</body>
</html>
